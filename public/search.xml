<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>LeetCode: Strong Password Checker</title>
      <link href="/2020/03/13/leetcode/LeetCode-Strong-Password-Checker/"/>
      <url>/2020/03/13/leetcode/LeetCode-Strong-Password-Checker/</url>
      
        <content type="html"><![CDATA[<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">strongPasswordChecker</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hasLowerCase <span class="keyword">bool</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hasUpperCase <span class="keyword">bool</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hasDigit <span class="keyword">bool</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">requireContains := <span class="number">0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i, _ := <span class="keyword">range</span> s &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> s[i] &gt;= <span class="string">'0'</span> &amp;&amp; s[i] &lt;= <span class="string">'9'</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">hasDigit = <span class="literal">true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> s[i] &gt;= <span class="string">'a'</span> &amp;&amp; s[i] &lt;= <span class="string">'z'</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">hasLowerCase = <span class="literal">true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> s[i] &gt;= <span class="string">'A'</span> &amp;&amp; s[i] &lt;= <span class="string">'Z'</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">hasUpperCase = <span class="literal">true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> !hasDigit &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">requireContains++</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> !hasLowerCase &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">requireContains++</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> !hasUpperCase &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">requireContains++</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> availableDeletes, requiredDeletes <span class="keyword">int</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> availableAdditions, requiredAdditions <span class="keyword">int</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(s) &gt; <span class="number">6</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">availableDeletes = <span class="built_in">len</span>(s) - <span class="number">6</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">&#125; <span class="keyword">else</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">requiredAdditions = <span class="number">6</span> - <span class="built_in">len</span>(s)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(s) &lt; <span class="number">20</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">availableAdditions = <span class="number">20</span> - <span class="built_in">len</span>(s)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">&#125; <span class="keyword">else</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">requiredDeletes = <span class="built_in">len</span>(s) - <span class="number">20</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// f[i, remove, add, replace]</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">f := <span class="built_in">make</span>([][][][]<span class="keyword">bool</span>, <span class="built_in">len</span>(s)+<span class="number">1</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= <span class="built_in">len</span>(s); i++ &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">f[i] = <span class="built_in">make</span>([][][]<span class="keyword">bool</span>, availableDeletes+<span class="number">1</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> d := <span class="number">0</span>; d &lt;= availableDeletes; d++ &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">f[i][d] = <span class="built_in">make</span>([][]<span class="keyword">bool</span>, availableAdditions+<span class="number">1</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> a := <span class="number">0</span>; a &lt;= availableAdditions; a++ &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">f[i][d][a] = <span class="built_in">make</span>([]<span class="keyword">bool</span>, <span class="built_in">len</span>(s)+<span class="number">1</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> r := <span class="number">0</span>; r &lt;= <span class="built_in">len</span>(s); r++ &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">f[i][d][a][r] = <span class="literal">false</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> i == <span class="number">0</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> d == <span class="number">0</span> &amp;&amp; r == <span class="number">0</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line">f[i][d][a][r] = <span class="literal">true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">continue</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> d+r &gt; i &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">continue</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> d != <span class="number">0</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line">f[i][d][a][r] = f[i][d][a][r] || f[i<span class="number">-1</span>][d<span class="number">-1</span>][a][r]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">71</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> a != <span class="number">0</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">72</span></pre></td><td class="code"><pre><span class="line">f[i][d][a][r] = f[i][d][a][r] || f[i<span class="number">-1</span>][d][a<span class="number">-1</span>][r]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">73</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">74</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> r != <span class="number">0</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">75</span></pre></td><td class="code"><pre><span class="line">f[i][d][a][r] = f[i][d][a][r] || f[i<span class="number">-1</span>][d][a][r<span class="number">-1</span>]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">76</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">77</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> i &gt; <span class="number">0</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">78</span></pre></td><td class="code"><pre><span class="line">f[i][d][a][r] = f[i][d][a][r] || f[i<span class="number">-1</span>][d][a][r]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">79</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">80</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">81</span></pre></td><td class="code"><pre><span class="line">lastCharIdx := i - <span class="number">1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">82</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">83</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> k := i - <span class="number">1</span>; k &gt; <span class="number">0</span>; k-- &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">84</span></pre></td><td class="code"><pre><span class="line">needToBreak := <span class="literal">false</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">85</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> s[k<span class="number">-1</span>] == s[lastCharIdx] &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">86</span></pre></td><td class="code"><pre><span class="line">repeatingLength := lastCharIdx - (k - <span class="number">1</span>) + <span class="number">1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">87</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> repeatingLength == <span class="number">3</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">88</span></pre></td><td class="code"><pre><span class="line">needToBreak = <span class="literal">true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">89</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">90</span></pre></td><td class="code"><pre><span class="line">&#125; <span class="keyword">else</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">91</span></pre></td><td class="code"><pre><span class="line">lastCharIdx = k - <span class="number">1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">92</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">93</span></pre></td><td class="code"><pre><span class="line">f[i][d][a][r] = f[i][d][a][r] || f[k][d][a][r]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">94</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> d != <span class="number">0</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">95</span></pre></td><td class="code"><pre><span class="line">f[i][d][a][r] = f[i][d][a][r] || f[k][d<span class="number">-1</span>][a][r]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">96</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">97</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> a != <span class="number">0</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">98</span></pre></td><td class="code"><pre><span class="line">f[i][d][a][r] = f[i][d][a][r] || f[k][d][a<span class="number">-1</span>][r]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">99</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">100</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> r != <span class="number">0</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">101</span></pre></td><td class="code"><pre><span class="line">f[i][d][a][r] = f[i][d][a][r] || f[k][d][a][r<span class="number">-1</span>]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">102</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">103</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> needToBreak &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">104</span></pre></td><td class="code"><pre><span class="line">f[i][d][a][r] = <span class="literal">false</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">105</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> j := k; j &lt; i; j++ &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">106</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> a != <span class="number">0</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">107</span></pre></td><td class="code"><pre><span class="line">f[i][d][a][r] = f[i][d][a][r] || f[j<span class="number">-1</span>][d][a<span class="number">-1</span>][r]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">108</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">109</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> r != <span class="number">0</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">110</span></pre></td><td class="code"><pre><span class="line">f[i][d][a][r] = f[i][d][a][r] || f[j<span class="number">-1</span>][d][a][r<span class="number">-1</span>]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">111</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">112</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">113</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">114</span></pre></td><td class="code"><pre><span class="line">idx := lastCharIdx</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">115</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> idx &gt;= <span class="number">0</span> &amp;&amp; s[idx] == s[lastCharIdx] &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">116</span></pre></td><td class="code"><pre><span class="line">idx--</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">117</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">118</span></pre></td><td class="code"><pre><span class="line">idx++</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">119</span></pre></td><td class="code"><pre><span class="line">repeatingCount := lastCharIdx - idx + <span class="number">1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">120</span></pre></td><td class="code"><pre><span class="line">deleting := repeatingCount - <span class="number">2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">121</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> d-deleting &gt;= <span class="number">0</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">122</span></pre></td><td class="code"><pre><span class="line">f[i][d][a][r] = f[i][d][a][r] || f[idx][d-deleting][a][r]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">123</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">124</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">break</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">125</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">126</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">127</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">128</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">129</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">130</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">131</span></pre></td><td class="code"><pre><span class="line">result := math.MaxInt64</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">132</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> d := requiredDeletes; d &lt;= availableDeletes; d++ &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">133</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> a := requiredAdditions; a &lt;= availableAdditions; a++ &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">134</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> r := <span class="number">0</span>; r &lt;= <span class="built_in">len</span>(s); r++ &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">135</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> f[<span class="built_in">len</span>(s)][d][a][r] &amp;&amp; a+r &gt;= requireContains &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">136</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> d+a+r &lt; result &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">137</span></pre></td><td class="code"><pre><span class="line">result = d + a + r</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">138</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">139</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">140</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">141</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">142</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">143</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">144</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> result</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">145</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode: Valid Number</title>
      <link href="/2020/03/12/leetcode/LeetCode-Valid-Number/"/>
      <url>/2020/03/12/leetcode/LeetCode-Valid-Number/</url>
      
        <content type="html"><![CDATA[<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isNumber</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    pattern := <span class="string">`^\s*[+-]?((\d+(\.\d*)?)|(\.\d+))(e[+-]?\d+)?\s*$`</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    match, _ := regexp.MatchString(pattern, s)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> match</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>All it takes is 10 minutes mindful minutes</title>
      <link href="/2020/02/19/ted/All-it-takes-is-10-minutes-mindful-minutes/"/>
      <url>/2020/02/19/ted/All-it-takes-is-10-minutes-mindful-minutes/</url>
      
        <content type="html"><![CDATA[<p>We live in an incredibly busy world. The pace of life is often frantic, our minds are always busy, and we’re always doing something. So with that in mind, I’d like you jst to take a moment to think, when did you last take any time to do nothing? Just 10 minutes, undisturbed? And when I say nothing, I do mean nothing. So that’s no emailing, texting, no Internet, no TV, no chatting, no eating, no reading. Not even sitting there reminiscing about the past or planning for the future. Simply doing nothing. I see a lot of very blank faces. I think it is probably you have to go a long way back. And this is an extraordinary thing, right? We’re talking about our mind. </p><p>The mind, our most valuable and precious resource, thrgouh which we experience every single moment of our life. The mind taht we rely upon to be happy, content, emotionally stable as individuals, and at the same time, to be kind and thoughtful and considerate in our relationships with others. This is the same mind that we depend upon to be focused, creative, spontaneous and to perform at our very best in everything that we do. And yet, we don’t take any time out to look after it. In fact, we spend more time looking after our cars, our clothes and our hair than we, okay, maybe not our hair, but you see where I’m going.</p><p>The result, of course, is that we get stressed. You know, the mind whizzes away like a washing machine, going round and round, lots of diffcult, confusing emotions, and we don’t really know how to deal with that. And the sad fact is that we are so distracted that we’re no longer present in the world in which we live. We miss out on teh things that are most important to us, and the crazy thing is that everybody just assumes, that’s the way life is, so we’ve jst kindof got to get on with it. That’s really not how it has to be.</p><p>So I was about 11 when I went along to my first meditation class. And trust me, it had all the stereotypes that you can imagine, the sitting cross-legged on the floor, the incense, the herbal tea, the vegetarians, the whole deal, but my mom was going and I was intrigued, so I went along with her. I’d also seen a few kung fu movies, and secretly I kind of though I might be able to leanr how to fly, but I was very young at the time. Now as I was there, I guess, like a lot of people, I assumed that it was just an aspirin for the mind. You get stressed, you do some meditation. I hadn’t really thought that it could be sort of preventative in nature, until I was about 20, when a number of things happend in my life, in quite quick succession, really serious things which just flipped my life upside down, and all of a sudden I was inundated with thoughts, inundated with diffcult emotions that I didn’t know how to cope with. Every time I sort of pushed one down, another one would pop back up again. It was a really very stressful time. I guess we all deal with stress in different ways. Some people will bury themselves in work, grateful for the distraction. Others will turn to their friends, their family, looking for support. Some people hit hte bottle, start taking medication. My own way of dealing with it was to become a monk. So I quit my degree, I headed off to the Himalayas, I became a monk, and I started studying meditation. People often ask me what I learned from that time. Well, obviously it changed things. Let’s face it, becoming a celibate monk is going to change a number of things. But it was more than that. It taught me, it gave me a greater appreciation, an understanding for the present moment. By that I mean not being lost in thought, not being distracted, not being overwhelmed by diffcult emotions, but instead learning how to be in the here and now, how to be mindful, how to be present. </p><p>I think the present moment is so underrated. It sounds so ordinary, and yet we spend so little time in the present moment that it’s anything but ordinary. There was a research paper that came out of Harvard, just recently, that said on average, our minds are lost in thought almost 47 percent of the time. At the same time, this sort of constant mind-wandering is also a direct cause of unhappiness. Now we’re not here for that long anyway, but tot spend almost half of our life lost in thought and potentially quite unhappy, I don’t know, it just kind of seems tragic, actually, especially when there’s something we can do about it, when there’s a positive, practical, achievable, scientifically proven technique which allows our mind to be more healthy, to be more mindful and less distracted. And the beauty of it is that even though it need only take about 10 minutes a day it impactes our entire life. But we need to know how to do it. We need an exercise. We need a framework to learn how to be more mindful. That’s essentially what meditation is.</p><p>It’s familiarizing ourselves with the present moment. But we also need to know how to approach it in the right way to get the best from it. And that’s what these are for, in case you’ve been wondering, because most people assume the meditation is all about stopping thoughts, getting rid of emotions, somehow controlling the mind, but actually it’s quite different from that. It’s more about stepping back, sort of seeing the thought clearly, witnessing it comming and going, emotions coming and going without judgment, but with a relaxed, focused mind. So for example, right now, if I focus too much on the balls, then there’s no way I can relax and talk to you at the same time. Equally, if I relax too much taling to you, there’s no way I can focus on the balls. I’m going to drop them. Now in life, and in meditation, there’ll be times when the focus becomes a little bit too intense, and life starts to feel a bit like this. It’s a very uncomfortable way to live life, when you get this tight and stressed. At other times, we might take our foot off the gas a little bit too much, and things just become a sort of little bit like this. Of course in meditation we’re going to end up falling asleep. So we’re looking for a balance, a focused relaxation where we can allow thoughts to come and go without all the usual involvement.</p><p>Now, what usually happens when we’re learning to be mindful is taht we get distracted by a thought. Let’s say this is an anxious thought. So everything’s going fine, and we see the anxious thought. “Oh, I didn’t realize I was worried about that.” You go back to it, repeat it. “Oh, I am worried. I am really worried. Wow, there’s so much anxiety.” And before we know it, right, we’re anxious about feeling anxious. You know, this is crazy. We do this all the time, even on an everyday level. If you think about the last time hyou had a wobbly tooth. You know it’s wobbly, and you know that it hurts. But what do you do every 20, 30 seconds? It does hurt. And we reinforce the storyline, right? And we just keep telling ourselves, and we do it all the time. And it’s only in learning to watch the mind in this way that we can start to let go of those storylines and patterns of mind. But when you sit down and you watch the mind in this way, you might see many differernt patterns. You might find a mind that’s really restless and the whole time. Don’t be surprised if you feel a bit agitated in your body when you sit down to do nothing and your mind feels like that. You might find a mind that’s very dull, and boring, and it’s just, almost mechanical, it just seems it’s as if you’re gettingup, going to work, eat, sleep, get up, work. Or it might jsut be that one little nagging thought that just goes round and round your mind. Well, whatever it its, meditation offers the opportunity, the potential to step back and to get a different perspective to see that things aren’t always as they appear.</p><p>You know, we can’t change every little thing that happens to us in life, but we can change the way that we experience it. That’s the potential of meditation, of mindfulness. You don’t have to burn any incense, and you definitely don’t have to sit on the floor. All you need to do is to take 10 minutes out a day to step back, to familiarize yourself with the present moment so that you get to experience a greater sense of focus, calm and clarity in your life. Thank you very much.</p>]]></content>
      
      
      <categories>
          
          <category> ted </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>GFS</title>
      <link href="/2020/01/09/paper/GFS/"/>
      <url>/2020/01/09/paper/GFS/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Web Document</title>
      <link href="/2020/01/09/architecture/Web-Document/"/>
      <url>/2020/01/09/architecture/Web-Document/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>POSIX</title>
      <link href="/2020/01/09/linux/POSIX/"/>
      <url>/2020/01/09/linux/POSIX/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>mysql</title>
      <link href="/2020/01/09/storage/mysql/"/>
      <url>/2020/01/09/storage/mysql/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ZooKeeper</title>
      <link href="/2020/01/09/ZooKeeper/"/>
      <url>/2020/01/09/ZooKeeper/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Consul</title>
      <link href="/2020/01/09/cloud/Consul/"/>
      <url>/2020/01/09/cloud/Consul/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hive</title>
      <link href="/2020/01/09/storage/Hive/"/>
      <url>/2020/01/09/storage/Hive/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HDFS</title>
      <link href="/2020/01/09/storage/HDFS/"/>
      <url>/2020/01/09/storage/HDFS/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hadoop</title>
      <link href="/2020/01/09/storage/Hadoop/"/>
      <url>/2020/01/09/storage/Hadoop/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HBase</title>
      <link href="/2020/01/09/storage/HBase/"/>
      <url>/2020/01/09/storage/HBase/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>affiliate</title>
      <link href="/2020/01/06/business/affiliate/"/>
      <url>/2020/01/06/business/affiliate/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>nginx</title>
      <link href="/2020/01/05/operation/nginx/"/>
      <url>/2020/01/05/operation/nginx/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>InfluxDB</title>
      <link href="/2020/01/03/storage/InfluxDB/"/>
      <url>/2020/01/03/storage/InfluxDB/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Redis</title>
      <link href="/2020/01/03/storage/Redis/"/>
      <url>/2020/01/03/storage/Redis/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>LevelDB</title>
      <link href="/2020/01/03/storage/LevelDB/"/>
      <url>/2020/01/03/storage/LevelDB/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Consensus Protocol: Paxos, Zab and Raft</title>
      <link href="/2020/01/02/cloud/Consensus-Protocol-Paxos-Zab-and-Raft/"/>
      <url>/2020/01/02/cloud/Consensus-Protocol-Paxos-Zab-and-Raft/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>RocksDB</title>
      <link href="/2020/01/02/storage/RocksDB/"/>
      <url>/2020/01/02/storage/RocksDB/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>TiDB</title>
      <link href="/2020/01/02/storage/TiDB/"/>
      <url>/2020/01/02/storage/TiDB/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> db </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>See you, 2019</title>
      <link href="/2019/12/31/odd/See-you-2019/"/>
      <url>/2019/12/31/odd/See-you-2019/</url>
      
        <content type="html"><![CDATA[<p>很早之前听过一个寓言，讲的是一个流浪汉经常在一个富人家附近乞讨，这个富人每次会给这个流量汉100美元，这个流浪汉每次都会很感激这个富人，然后很快的就把钱花光了。当流浪汉逐渐习惯了这一切，突然有一天富人路过，然后直接无视了流浪汉，流浪汉就上前抱怨：“我一直在这里等你，为什么不给我100美元”，富人说：“我已经给了你1000美元了，这足够你开始新的生活了，可你缺都挥霍掉了。” 不太记得这寓言本身想表达的含义了，知道一天听到华为一个高龄员工被辞退的新闻，脑子里就突然蹦出了这个故事。嘲讽的，这一切刚好和这个故事吻合。那个高龄的员工就是那个“流浪汉”，公司就是那个“富人”，工作了十几年勤勤恳恳，就是那“1000美元”。</p><p>就是这个故事，让2019年对我来说，完全是人生的一个转折，也是一次很大的冒险。既然目标已经明确了，等2020年结束的时候，再来补充这个帖子吧（未完待续……）</p>]]></content>
      
      
      <categories>
          
          <category> odd </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Rocket MQ</title>
      <link href="/2019/12/30/mq/Rocket-MQ/"/>
      <url>/2019/12/30/mq/Rocket-MQ/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> mq </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Are You A Giver Or A Taker?</title>
      <link href="/2019/12/27/ted/are-you-a-giver-or-a-taker/"/>
      <url>/2019/12/27/ted/are-you-a-giver-or-a-taker/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.ted.com/talks/adam_grant_are_you_a_giver_or_a_taker/up-next" target="_blank" rel="noopener">origin address</a></p><p>I want you to look arount the room for a minute and try to find the most paranoid person here. And then i want you to point at that person for me. OK, don’t actually do it. But, as an organizational psychologist, I spend a lot of time in workplaces, and I find paranoia everywhere.</p><p>Paranoia is caused by people that I call “takers.” Takers are self-serving in their interactions. It’s all about what can you do for me. The opposite is a giver. It’s somebody who approaches most interactions by asking, “What can I do for you?” I wanted to give you a chance to think about your own style. We all have moments of giving and taking. Your style is how you treat most of the people most of the time, your default. So I have a short test you can take to figure out if you’re more of a giver or a taker, and you can take it right now. (Moments later) This is the only thing i will say today that has no data behind it, but I am convinced the longer it takes for you to laugh at this cartoon, the more worried we should be that you’re a taker. Of course, not all takers are narcissists. Some are just givers who got burned one too many times. Then there’s another kind of taker that we won’t be addressing today, and that’s called a psychopath. I was curious, though, about how common these extremes are, and so I surveyed over 30,000 people across industries around the world’s cultures. And I found that most people are right in the middle between giving and taking. They choose this third style called “matching.” If you’re a matcher, you try to keep an even balance of give and take: quid pro quo. I’ll do something for you if you do something for me. And that seems like a safe way to live your life. But is it the most effective and productive way to live your life? The answer to that question is a very definitive: maybe. I studied dozens of organizations, thousands of people. I had engineers measuring their productivity. I looked at medical students’ grades, even salespeople’s revenue. And, unexpectedly, the worst performers in each of these jobs were the givers. The engineers who got the least work done were the ones who did more favors than they got back. They were so busy doing other people’s jobs, they literally ran out of time and energy to get their own work completed. In medical school, the lowest grades belong to the students who agree most strongly with statements like, “I love helping others,” which suggestes the doctor you ought to trust is the one who came to med school with no desire to help anybody. And then in sales, too, the lowest revenue accrued in the most generous salspeople. I actually reached out to one of those salespeople who had a very high giver score. And I asked him, “Why do you suck at your job”… I don’t ask that way. “What’s the cost of generosity in sales?” And he said, “Well, I just care so deeply about my customers that I would never sell them one of our crappy products.” So just out of curiosity, how many of you self-identify more as givers than takers or matchers? Raise your hands. OK, it would have been more before we talked about these data. But actually, it turns out there’s a twist here, because givers are oftern sacrificing themselves, but they make their organizations better. We have a huge body of evidence, many, many studies looking at the frequency of giving behavior that exists in a team or an organization and the more oftern people are helping and sharing their knowledge and providing mentoring, the better organiztions do on every metric we can measure: higher profits, customers satisfaction, employee retention, even lower operating expenses. So givers spend a lot of time trying to help other people and improve the team, and them, unfortunately, they suffer along the way. </p><p>I want to talk about what it takes to build cultures where givers actually get to succeed. So I wondered, then, if givers are the worst performers, who are the best performers? Let me start with the good news: it’s not the takers. Takers tend to rise quickly but also fall quickly in most jobs. And they fall at the hands of matchers. If you’re a matcher, you believe in “An eye for an eye” – a just world. And so when you meet a taker, you feel like it’s your mission in life to just punish the hell out of that person. And that way justice gets served. Well, most people are matchers. And that means if you’re a taker, it tends to catch up with you eventually; what goes around will come around. And so the logical conclusion is: it must be the matchers who are the best performers. But they’re not. In every job, in every organization I’ve ever studied, the best results belong to the givers again.</p><p>Take a look at some data I gathered from hundreds of salespeople, tracking their revenue. What you can see is that the givers go to both extremes. They make up the majority of people who bring in the lowest revenue, but also the highest revenue. The same patterns were true for engineers’ productivity and medical students’ grades. Givers are overrepresented at the bottom and at the top of every success metric that I can track. Which raises the question: How do we create a world where more of these givers get to excel? I want to talk about how to do that, not just in businesses, but also in nonprofits, schools, even governments. Are you ready? I was going to do it anyway, but I appreciate the enthusiasm. </p><p>The first thing that’s really critical is to recognize that givers are your most valuable people, but if they’re not careful, they burn out. So you have to protect the givers in your midst. And I learned a great lesson about this from Fortune’s best networker. It’s the guy, not the cat. His name is Adam Rifkin. He’s a very successful serial entrepreneur who spends a huge amount of his time helping other people. And his secret weapon is the five-minute favor. Adam said, “You don’t have to be Mother Teresa or Gandhi to be a giver. You just have to find small ways to add large value to other people’s lives.” That could be as simple as making an introduction between two people who could benefit from knowing each other. It could be sharing your knowlege or giving a little bit of feedback. Or it might be even something as basic as saying, “You know, I’m going to try and figuer out if I can recognize somebody whose work has gone unnoticed.” And those five-minute favors are really critical to helping givers set boundaries and protect themselves. The second thing that matters if you want to build a culture where givers succeed, is you actually need a culture where help-seeking is the norm; where people ask a lot. This may hit a little too close to home for some of you. What you see with successful givers is they recognize that it’s OK to be a receiver, too. If you run an organization, we can actually make this easier. We can make it easier for people to ask for help. A couple colleagues and I studied hospitals. We found that on certain floors, nurses did a lot of help-seeking, and on other floors, they did very little of it. The factor that stood out on the floors where help-seeking was common, where it was the norm, was there was just one nurse whose sole job it was to help other nurses on the unit. When that role was avaiable, nurses said, “It’s not embarrassing, it’s not vulnerable to ask for help, it’s actually encouraged.” Help-seeking isn’t important just for protecting the success and the well-being of givers. It’s also critical to getting more people to act like givers, because the data say that somewhere between 75 and 90 percent of all giving in organizations starts with a request. But a lot of people don’t ask. They don’t want to look imcompetent, they don’t know where to turn, they don’t want to burden others. Yes if nobody ever asks for help, you have a lot of frustrated givers in your organization who would love to step up and contirbute, if they only knew who could benefit and how.</p><p>But I think the most important thing, if you want to build a culture of successful givers, is to be thoughtful about who you let onto your team. I figured, you want to culture of productive generosity,  you should hire a bunch of givers. But I was surprised to discover, actually, that that was not right, that the negative impact of a taker on a culture is usually double to triple the positive impact of a giver. Think about it this way: one bad apple can spoil a barrel, but one good egg just does not make a dozen. I don’t know what that means. But I hope you do. No, let even one taker into a team, and you will see that the givers will stop helping. They’ll say, “I’m surrounded by a bunch of snakers and sharks. Why should I contribute?” Whereas if you let one giver into a team, you don’t get an explosion of generosity. More often, people are like, “Great! That person can do all our work.” So, effective hiring and screening and team building is not about bringing in the givers; it’s about weeding out the takers. If you can do that well, you’ll be left with givers and matchers. The givers will be generous because they don’t have to worry about the consequences. And the beauty of the matchers is that they follow the norm.</p><p>So how do you catch a taker before it’s too late? We’re actually bad at figuring out who’s taker, especially on first impressions. There’s a personality trait that throws us off. It’s called aggreableness, one the major dimensions of personality across cultures. Agreeable people are warm and friendly, they’re nice, they’re polite. You find a lot of them in Canada, where ther was actually a national contest to come up with a new Canadian slogan and fill in the blank, “As Canadian as…” I though the winning entry was going to be, “As Canadian as maple syrup,” or, “… ice hockey.” But no, Canadians voted for their new national slogan to be, I kid you not, “As Canadian as possible under the circumstances.” Now for those of you who are highly agreeable, or maybe slightly Canadian, you get this right away. How could I ever say I’m any one thing when I’m constantly adapting to try to please other people? Disagreeable people do less of it. They’re more critical, skeptical, challenging, and far more likely than their peers to go to law school. That’s not a joke, that’s actually an empirical fact. So I always assumed that agreeable people were givers and disagreeable people were takers. But then I gathered the data, and I was stunned to find no correlation between those traits, because it turns out that agreeableness-disagreeableness is your outer veneer: How pleasant is it to interact with you? Whereas giving and taking are more of your inner motives: What are your values? What are your intentions toward others? If you really want to judge people accurately, you have to get to teh moment every consultant in the room is waiting for, and draw a two-by-two.</p><p>The agreeable givers are easy to spot: they say yes to everything. The disagreeable takers are also recognized quickly, although you might call them by a slightly different name. We forget about the other two combinations. There are disagreeable givers in our organizations. There are people who are gruff and tough on the surface but underneath have others’ best interests at heart. Or as an engineer put it, “Oh, disagreeable givers like somebody with a bad user interface but a great operating system.” If that helps you. Disagreeable givers are the most undervalued poeple in our organizations, because they’re the ones who give the critical feedback that no one wants to hear but everyone needs to hear. We need to do a much better job valuing these people as opposed to writing them off early, and saying, “Eh, kind of prickly, must be s selfish taker.” The other combination we forget about is the deadly one the agreeable taker, also known as the faker. This is the person who’s nice to your face, and then will stab you right in the back. And my favorite way to catch these people in the interview process is to ask the question, “Can you give me the names of four people whose careers you have fundamentally improved?” The takers will give you four names, and they will all be more influential than them, because takers are great at kissing up and then kicking down. Givers are more likely to name people who are below them in a hierarchy, who don’t have as much power, who can do them no good. And let’s face it, you all know you can learn a lot about character by watching how someone treats their restaurant server or their Uber driver.</p><p>So if we do all this well, if we can weed takers out of organizations, if we can make it safe to ask for help, if we can protect givers from burnout and make it OK for them to be ambitious in pursuing their own goals as well as trying to help other people, we can actually change the way that people define success. Instead of saying it’s all about winning a competition, people will realize success is realy more about contribution. I believe that the most meaningful way to succeed is to help other people succeed. And if we can spread that belief, we can actually turn paranoia upside down. There’s a name for that. It’s called “pronoia.” Pronoia is the delusional belief that other people are plotting your well-being. That they’re going around behind your back and saing exceptionally glowing things about you. The great thing about a culture of givers is that’s not a delusion it’s reality.</p><p>I want to live in a world where givers succeed, and I hope you will help me create that world. Thank you.</p>]]></content>
      
      
      <categories>
          
          <category> ted </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Why Do Cats Act So Weird</title>
      <link href="/2019/12/26/ted/why-do-cats-act-so-weird/"/>
      <url>/2019/12/26/ted/why-do-cats-act-so-weird/</url>
      
        <content type="html"><![CDATA[<p>They’re cute, they’re lovable, and judging by the 26 billions views of over 2 million YouTube videos of them pouncing, bouncing, climbing, cramming, stalking, clawing, chattering and purring, one thing is certain: cats are very entertaining. </p><p>These somewhat strange feline behaviors, both amusing and baffling, leave many of us asking, “Why do cats do that?” </p><p>Throughout time, cats were simultaneously solitary predators of smaller animals and prey for larger carnivores. As both predator and prey, survival of their species depended on crucial instinctual behaviors which we still observe in wild and domestic cats today. While the feline actions of your house cat Grizmo might seem perplexing, in the wild, these same behaviors, naturally bred into cats for millions of years, would make Grizmo a super cat. </p><p>Enabled by their unique muscular structure and keen balancing abilities, cats climbed to high vantage points to survey their territory and spot prey in the wild. Grizmo doesn’t need these particular skills to find and hunt down dinner in her food bowl today, but instinctually, viewing the living room from the top of the bookcase is exactly what she has evolved to do. </p><p>As wild predators, cats are opportunistic and hunt whenever prey is available. Since most cat prey are small, cats in the wild needed to eat many times each day, and use a stalk, pounce, kill, eat strategy to stay fed. This is why Grizmo prefers to chase and pounce on little toys and eat small meals over the course of the day and night. </p><p>Also, small prey tend to hide in tiny spaces in their natural environments, so one explanation for Grizmo’s propensity to reach into containers and openings is that she is compelled by the same curiosity that helped ensure the continuation of her species for millions of years before. </p><p>In the wild, cats needed sharp claws for climbing, hunting, and self-defense. Sharpening their claws on nearby surfaces kept them conditioned and ready, helped stretch their back and leg muscles, and relieve some stress, too. So it’s not that Grizmo hates your couch, chair, ottoman, pillows, curtains, and everything else you put in her environment. She’s ripping these things to shreds and keeping her claws in tip-top shape because this is exactly what her ancestors did in order to survive. </p><p>As animals that were preyed upon, cats evolved to not get caught, and in the wild, the cats that were the best at avoiding predators thrived. So at your house today, Grizmo is an expert at squeezing into small spaces and seeking out and hiding in unconventional spots. It also explains why she prefers a clean and odor-free litter box. That’s less likely to give away her location to any predators that my be sniffing around nearby.</p><p>Considering everything we do know about cats, it seems that one of their most predominate behaviors is still one of the most mysterious. Cats may purr for any number of reasons, such as happiness, stress and hunger. But curiously, the frequency of their purrs, between 25 and 150 hertz, is within a range that can promote tissue regeneration. So while her purring makes Grizmo an excellent nap companion, it is also possible that her purr is healing her muscles and bones, and maybe even yours, too. </p><p>They developed through time as both solitary predators that hunted and killed to eat, and stealthy prey that hid and escaped to survive. So cats today retain many of the smae instincts that allowed them to thrive in the wild for millions of years. This explains some of their seemingly strange behaviors. To them, our homes are their jungles. But if this is the case, in our own cat’s eyes, who are we? Big, dumb, hairless cats competing with them for resources? Terribly stupid predators they’re able to outsmart every day? Or maybe they think we’re the prey.</p>]]></content>
      
      
      <categories>
          
          <category> ted </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Why Good Leaders Make You Feel Safe</title>
      <link href="/2019/12/26/ted/why-good-leaders-make-you-feel-safe/"/>
      <url>/2019/12/26/ted/why-good-leaders-make-you-feel-safe/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.ted.com/talks/simon_sinek_why_good_leaders_make_you_feel_safe?referrer=playlist-how_to_be_a_good_mentor" target="_blank" rel="noopener">original address</a></p><p>There’s a man by the name of Captain William Swenson, who recently was awarded the congressional Medal of Honor for his actions on September 8, 2009. On that day, a column of American and Afghan troops were making their way through a part of Afghanistan to help protect a group of government officials who would be meeting with come local village elders. The column came under ambush, and was surrounded on three sides, and amongst many other things, Captain Swenson was recognized for running into live fire to rescue the wounded and pull out the dead. One of the people he rescued was a sergeant, and he and a comrade were making their way to a medevac helicopter. And what was remarkable about this day is, by sheer coincidence, one of the medevac medics happened to have a GoPro camera on his helmet and captured the whole scene on camera. It shows Captain Swenson and his comrade bringing this wounded soldier who had received a gunshot to the neck. They put him in the helicopter, and then you see Captain Swenson bend over and give him a kiss before he turns around to rescue more. </p><p>I saw this, and I thought to myself, where do people like that come from? What is that? That is some deep, deep, emotion, when you would want to do that. There’s a love there, and I want to know why is that I don’t have people that I work with like that? You know, in the military, they give medals to people who are willing to sacrifice themselves so that others may gain. In business, we give bonuses to people who are willing to sacrifice others so that we may gain. We have it backwards. Right? So I asked myself, where do people like this come from? And my initial conclusion was that they’re just better people. That’s why they’re attracted to the military. These better people are attracted to this concept of service. But that’s completely wrong. </p><p>What I learned was that it’s the environment, and if you get the environment right, every single one of us has the capacity to do these remarkable things, and more importantly, others have that capacity too. I’ve had the great honor of getting to meet some of these, who we would call heroes, who have put themselves and put their lives at risk to save others, and I asked them, “Why would you do it? Why did you do it?” And they all say the same thing: “Because they would have done it for me.” It’s this deep sense of trust and cooperation. So trust and cooperation are really important here. The problem with concepts of trust and cooperation is that they are feelings, they are not instructions. I can’t simple say to you, “Trust me,” and you will. I can’t simple instruct two people to cooperate, and they will. It’s not how it works. It’s a feeling. So where does that feeling come from? </p><p>If you go back 50,000 years to the Paleolithic era, to the early days of Homo sapiens, what we find is that the world was filled with danger, all of there forces working very, very hard to kill us. Nothing personal. Whether it was the weather, lack of resources, maybe a saber-toothed tiger, all of these thing working to reduce our lifespan. And so we evolved into social animals, where we lived together and worked together in what I call a circle of safety, inside the tribe, where we felt like we belonged. And when we felt safe amongst our own, the natural reaction was trust and cooperation. There are inherent benefits to this. It means I can fall asleep at night and trust that someone from within my tribe will watch for danger. If we don’t trust each other, if I don’t trust you, that means you won’t watch for danger. Bad system of survival. The modern day is exactly the same thing. The world is filled with danger, things that are trying to frustrate our lives or reduce our success, reduce our opportunity for success. It could be the ups and downs in the economy, the uncertainty of the stock market. It could be a new technology that renders your business model obsolete overnight. Or it could be your competition that is sometimes trying to kill you. It’s sometimes trying to put you out of business, but at the very minimum is working hard to frustrate your growth and steal your business from you. We have no control over these forces. There are a constant, and they’re not going away. The only variable are the conditions inside the organization, and that’s where leadership matters, because it’s the leader that sets the tone. When a leader makes the choice to put the safety and lives of the people inside the organization first, to sacrifice their comforts and sacrifice the tangible results, so that the people remain and feel safe and feel like they belong, remarkable things happen. </p><p>I was flying on a trip, and I was witness to an incident where a passenger attempted to board before their number was called, and I watched the gate agent, treat this man like he had broken the law, like a criminal. He was yelled at for attempting to board one group too soon. So I said something. I said, “Why do you have treat us like cattle? Why can’t you treat us like human beings?” And this is exactly what she said to me. She said, “Sir, if I don’t follow the rules, I could get in trouble or lose my job.” All she was telling me is that she doesn’t feel safe. All she was telling me is that she doesn’t trust her leaders. The reason we like flying Southwest Airlines is not because they necessarily hire better people. It’s they don’t fear their leaders. You see, if the conditions are wrong, we are forced to expand our own time and energy to protect ourselves from each other, and that inherently weakens the organization. When we feel safe inside the organization, we will naturally combine our talents and our strengths and work tirelessly to face the dangers outside and seize the opportunities. </p><p>The closest analogy I can give to what a great leader is, is like being a parent. If you think about what being a great parent is, what do you want? What makes a great parent? We want to give our child opportunities, education, discipline them when necessary, all so that they can grow up and achieve more than we could for ourselves. Great leaders want exactly the same thing. They want to provide provide people opportunity, education, discipline when necessary, build their self-confidence, give them the opportunity to try and fail, all so that they could achieve more than we could ever imagine for ourselves.</p><p>Charlie Kim, who’s the CEO of a company called Next Jump in New York City, a tech company, he makes the point that if you had hard times in your family, would you ever consider laying off one of your children? We would never do it. Then why do we consider laying off people inside our organization? Charlie implemented a policy of lifetime employment. If you get a job at Next Jump, you cannot get fired for performance issues. In fact, if you have issues, they will coach you and they will give you support, just like we would with one of our children who happens to come home with a C fro school. It’s the complete opposite. This is the reason so many people have such a visceral hatred, anger, at some of these banking CEOs with their disproportionate salaries and bonus structures. It’s not the numbers. It’s that they have violated the very definition of leadership. They have violated this deep-seated social contract. We know that they allowed their people to be sacrificed so they could protect their own interests, or worse, they sacrificed their people to protect their own interests. This is what so offends us, not the numbers. Would anybody be offended if we gave a $150 million bonus to Gandhi? How about a $250 million bonus to Mother Teresa? Do we have an issue with that? None at all. Great leaders would never sacrifice the people to save the numbers. They would sooner sacrifice the numbers to save the people.</p><p>Bob Chapman, who runs a large manufacturing company in the Midwest called Barry-Wehmiller, in 2008 was hit very hard by the recession, and they lost 30 percent of their orders overnight. Now in a large manufacturing company, this is a big deal, and they could no longer afford their labor pool. They needed to save 10 million dollars, so like so many companies today, the board got together and discussed layoff. And Bob refused. You see, Bob doesn’t believe in head counts. Bob believes in heart counts, and it’s much more difficult to simply reduce the heart count. And so they came up with a furlough program. Every employee, from secretary to CEO, was required to take four weeks of unpaid vacation. They could take it any time they wanted, and they did not have to take it consecutively. But is was how Bob announced the program that mattered so much. He said, it’s better that we should all suffer a little than any of us should have to suffer a lot, and morale went up. They saved 20 million dollars, and most importantly, as would be expected, when the people feel safe and protected by the leadership in the organization, the natural reaction is to trust and cooperate. And quite spontaneously, nobody expected, people started trading with each other. Those who could afford it more would trade with those who could afford it less. People would take five weeks so that somebody else only had to take three. Leadership is a choice. It is not a rank. I know many people at the seniormost levels of organizations who are absolutely not leaders. They are authorities, and we do what they say because they have authority over us, but we would not follow them. And I know many people who are at the bottoms of organizations who have no authority and they are absolutely leaders, and this is because they have chosen to look after the person to left of them, and they have chosen to look after the person to the right of them. This is what a leader is.</p><p>I heard a story of some Marines, who were out in theater, and as is the Marine custom, the officer ate last, and he let his men eat first, and when they were done, there was no food left for him. And when they went back out in the field, his men brought him some of their food so that he may eat, because that’s what happens. We call them leaders because they go first. We call them leaders because they take the risk before anybody else does. We call them leaders because they will choose to sacrifice so that their people may be safe and protected and so their people may gain, and when we do, the natural response is that our people will sacrifice for us. They will give us their blood and sweat and tears to see that their leaders’ vision comes to life, and when we ask them, “Why would you do that? Why would you give your blood and sweat and tears for that person?” They all say the same thing: “Because they would have done it for me.” And isn’t that the organization we would all like to work in? Thank you very much.</p>]]></content>
      
      
      <categories>
          
          <category> ted </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Context In Go</title>
      <link href="/2019/12/24/golang/context/"/>
      <url>/2019/12/24/golang/context/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>http/2</title>
      <link href="/2019/12/17/protocal/http-2/"/>
      <url>/2019/12/17/protocal/http-2/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> protocal </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Rate Limit &amp; Circuit Breaker</title>
      <link href="/2019/12/15/golang/rate-limit-circuit-breaker/"/>
      <url>/2019/12/15/golang/rate-limit-circuit-breaker/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Iptables</title>
      <link href="/2019/12/15/operation/iptables/"/>
      <url>/2019/12/15/operation/iptables/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> operation </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>One Piece</title>
      <link href="/2019/12/15/odd/one-piece/"/>
      <url>/2019/12/15/odd/one-piece/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Kerberos</title>
      <link href="/2019/12/09/3a/kerberos/"/>
      <url>/2019/12/09/3a/kerberos/</url>
      
        <content type="html"><![CDATA[<p>This is the classic dialogue to explain the principle of Kerberos.</p><h2 id="Dramatis-Personae"><a href="#Dramatis-Personae" class="headerlink" title="Dramatis Personae"></a>Dramatis Personae</h2><p><strong>Athena</strong>:     an up and coming system developer.<br><strong>Euripides</strong>:  a seasoned developer and resident crank.</p><h2 id="Scene-I"><a href="#Scene-I" class="headerlink" title="Scene I"></a>Scene I</h2><p>A cubicle area. <strong>Athena</strong> and <strong>Euripides</strong> are working at neighboring terminals.</p><p><strong>Athena</strong>:    Hey Rip, this timesharing system is a drag. I can’t get any work done because everyone else is logged in.<br><strong>Euripides</strong>:    Don’t complain to me. I only work here.<br><strong>Athena</strong>:    You know what we need? We need to give everyone their own workstation so they don’t have to worry about sharing computer cycles. And we’ll use a network to connect all the workstations so folks can communicate with one another.<br><strong>Euripides</strong>:    Fine. So what do we need, about a thousand workstations?<br><strong>Athena</strong>:    More or less.<br><strong>Euripides</strong>:    Have you seen the size of a typical workstation’s disk drive? There isn’t enough room for all the software that you have on a timesharing machine.<br><strong>Athena</strong>:    I figured that out already. We can keep copies of the system software on various server machines. When you login to a workstation, the workstation accesses the system software by making a network connection with one of the servers. This setup lets a whole bunch of workstations use the same copy of the system software, and it makes software updates convenient. You don’t have to trundle around to each workstation. Just modify the system software servers.<br><strong>Euripides</strong>:    All right. What are you going to do about personal files? With a timesharing system I can login and get to my files from any terminal that is connected to the system. Will I be able to walk up to any workstation and automatically get to my files? Or do I have to make like a PC user and keep my files on diskette? I hope not.<br><strong>Athena</strong>:    I think we can use other machines to provide personal file storage. You can login to any workstation and get to your files.<br><strong>Euripides</strong>:    What about printing? Does every workstation have its own printer? Whose money are you spending anyway? And what about electronic mail? How are you going to distribute mail to all these workstations?<br><strong>Athena</strong>:    Ah . . . Well obviously we don’t have the cash to give everyone a printer, but we could have machines dedicated to print service. You send a job to a print server, and it prints it for you. You could do sort of the same thing with mail. Have a machine dedicated to mail service. You want your mail, you contact the mail server and pick up your mail.<br><strong>Euripides</strong>:    Your workstation system sounds really good Tina. When I get mine, you know what I’m going to do? I’m going to find out your username, and get my workstation to think that I am you. Then I’m going to contact the mail server and pick up your mail. I’m going to contact your file server and remove your files, and–<br><strong>Athena</strong>:    Can you do that?<br><strong>Euripides</strong>:    Sure! How are these network servers going to know that I’m not you?<br><strong>Athena</strong>:    Gee, I don’t know. I guess I need to do some thinking.<br><strong>Euripides</strong>:    Sounds like it. Let me know when you figure it out.</p><h2 id="Scene-II"><a href="#Scene-II" class="headerlink" title="Scene II"></a>Scene II</h2><p><strong>Euripides</strong>,’ office, the next morning. Euripides sits at his desk, reading his mail. <strong>Athena</strong>, knocks on the door.<br><strong>Athena</strong>,:    Well I’ve figured out how to secure an open network environment so that unscrupulous folks like you cannot use network services in other people’s names.<br><strong>Euripides</strong>,:    Is that so? Have a seat.<br>She does.<br><strong>Athena</strong>,:    Before I describe it, can I lay down one ground rule about this discussion?<br><strong>Euripides</strong>,:    What’s your rule?<br><strong>Athena</strong>,:<br>Well suppose I say something like the following: “I want my electronic mail, so I contact the mail server and ask it to send the mail to my workstation.” In reality I’m not the entity that contacts the mail server. I’m using a program to contact the mail server and retrieve my mail, a program that is a CLIENT of the mail service program.</p><p>But I don’t want to say “the client does such-and-such” every time I refer to a transaction between the user and a network server. I’d just as soon say “I do such-and-such,” keeping in mind of course that a client program is doing things on my behalf. Is that okay with you?</p><p><strong>Euripides</strong>,:    Sure. No problem.<br><strong>Athena</strong>,:    Good. All right, I’ll begin by stating the problem I have solved. In an open network environment, machines that provide services must be able to confirm the identities of people who request service. If I contact the mail server and ask for my mail, the service program must be able to verify that I am who I claim to be, right?<br><strong>Euripides</strong>,:    Right.<br><strong>Athena</strong>,:    You could solve the problem clumsily by requiring the mail server to ask for a password before I could use it. I prove who I am to the server by giving it my password.<br><strong>Euripides</strong>,:    That’s clumsy all right. In a system like that, every server has to know your password. If the network has one thousand users, each server has to know one thousand passwords. If you want to change your password, you have to contact all servers and notify them of the change. I take it your system isn’t this stupid.<br><strong>Athena</strong>,:    My system isn’t stupid. It works like this: Not only do people have passwords, services have passwords too. Each user knows her or his password, each service program knows its password, and there’s an AUTHENTICATION SERVICE that knows ALL passwords–each user’s password, and each service’s password. The authentication service stores the passwords in a single, centralized database.<br><strong>Euripides</strong>,:    Do you have a name for this authentication service?<br><strong>Athena</strong>,:    I haven’t thought of one yet. Do you have any ideas?<br><strong>Euripides</strong>,:    What’s the name of that fellow who ferries the dead across the River Styx?<br><strong>Athena</strong>,:    Charon?<br><strong>Euripides</strong>,:    Yeah, that’s him. He won’t take you across the river unless you can prove your identity.<br><strong>Athena</strong>,:    There you go Rip, trying to rewrite Greek mythology again. Charon doesn’t care about your identity. He just wants to make sure that you’re dead.<br><strong>Euripides</strong>,:    Have you got a better name?<br>Pause.<br><strong>Athena</strong>,:    No, not really.<br><strong>Euripides</strong>,:    Then let’s call the authentication service “Charon.”<br><strong>Athena</strong>,:<br>Okay. I guess I should describe the system, huh?</p><p>Let’s say you want to use a service, the mail service. In my system you cannot use a service unless, ah, Charon tells the service that you are who you claim to be. And you can’t get the okay to use a service unless you have authenticated yourself to Charon. When you request authentication from Charon, you have to tell Charon the service for which you want the okay. If you want to use the mail server, you’ve got to tell Charon.</p><p>Charon asks you to prove your identity. You do so by providing your secret password. Charon takes your password and compares it to the one that is registered for you in the Charon database. If the two passwords match, Charon considers your identity proven.</p><p>Charon now has to convince the mail server that you are who you say you are. Since Charon knows all service passwords, it knows the mail service’s password. It’s conceivable that Charon could give you the password, which you could forward to the mail service as proof that you have authenticated yourself to Charon.</p><p>The problem is, Charon cannot give you the password directly, because then you would know it. The next time you wanted mail, you could circumvent Charon and use the mail server without correctly identifying yourself. You could even pretend to be someone else, and use the mail server in that other person’s name.</p><p>So instead of giving you the mail server’s password, Charon gives you a mail service TICKET. This ticket contains a version of your username that has been ENCRYPTED USING the MAIL SERVER’S PASSWORD.</p><p>Ticket in hand, you can now ask the mail service for your mail. You make your request by telling the mail server who you are, and furnishing the ticket that proves you are who you say you are.</p><p>The server uses its password to decrypt the ticket, and if the ticket decrypts properly, the server ends up with the username that Charon placed in the ticket.</p><p>The service compares this name with the name you sent along with the ticket. If the names match, the mail server considers your identity proven and proceeds to give you your mail.</p><p>What do you think of those apples?</p><p><strong>Euripides</strong>,:    I’ve got some questions.<br><strong>Athena</strong>,:    I figured. Well go ahead.<br><strong>Euripides</strong>,:    When a service program decrypts a ticket, how does it know that it has decrypted the ticket properly?<br><strong>Athena</strong>,:    I don’t know.<br><strong>Euripides</strong>,:    Maybe you should include the service’s name in the ticket. That way when a service decrypts a ticket, it can gauge its success on whether or not it can find its name in the decrypted ticket.<br><strong>Athena</strong>,:<br>That sounds good to me. So the ticket looks something like this:</p><p>(She scrawls the following on a pad of paper:)<br>   TICKET -  {username:servicename}<br><strong>Euripides</strong>,:    So the service ticket contains just your username and the servicename?<br><strong>Athena</strong>,:    Encrypted with the service’s password.<br><strong>Euripides</strong>,:    I don’t think that’s enough information to make the ticket secure.<br><strong>Athena</strong>,:    What do you mean?<br><strong>Euripides</strong>,:    Let’s suppose you ask Charon for a mail server ticket. Charon prepares that ticket so that it has your username “tina” in it. Suppose I copy that ticket as it wizzes by on its way across the network from Charon to you. Suppose I convince my insecure workstation that my username is “tina.” The mail client program on my workstation thinks I am you. In your name, the program forwards the stolen ticket to the mail server. The server decrypts the ticket and sees that it is valid. The username in the ticket matches the name of the user who sent the ticket. The mail server gives me your mail . . .<br><strong>Athena</strong>,:    Oh! Well that’s not so good.<br><strong>Euripides</strong>,:<br>But I think I know a way to fix this problem. Or to at least provide a partial fix to it. I think Charon should include more information in the service tickets it produces. In addition to the username, the ticket should also include the NETWORK ADDRESS from which the user asked Charon for the ticket. That gives you an additional level of security.</p><p>I’ll illustrate. Suppose I steal your mail ticket now. The ticket has your workstation’s network address in it, and this address does not match my workstation’s address. In your name I forward the purloined ticket to the mail server. The server program extracts the username and network address from the ticket and attempts to match that information against the username and network address of the entity that sent the ticket. The username matches, but the network address does not. The server rejects the ticket because obviously it was stolen.</p><p><strong>Athena</strong>,:    Bravo, bravo! I wish I had thought of that.<br><strong>Euripides</strong>,:    Well that’s what I’m around for.<br><strong>Athena</strong>,:<br>So the revised ticket design looks like this:</p><p>She scrawls the following on a chalkboard:</p><p>  TICKET -   {username:ws_address:servicename}<br><strong>Athena</strong>,:    Now I’m really excited. Let’s build a Charon system and see if it works!<br><strong>Euripides</strong>,:    Not so fast. I have some other questions about your system.<br><strong>Athena</strong>,:    All right. (Athena leans forward in her chair) Shoot.<br><strong>Euripides</strong>,:    Sounds like I’ve got to get a new ticket every time I want to use a service. If I’m putting in a full day’s work, I’ll probably want to get my mail more than once. Do I have to get a new ticket every time I want to get my mail? If that’s true, I don’t like your system.<br><strong>Athena</strong>,:    Ah . . . Well I don’t see why tickets can’t be reusable. If you get a ticket for the mail server, you ought to be able to use it again and again. For instance, when the mail client program makes a request for service in your name, it forwards a COPY of the ticket to the mail server.<br><strong>Euripides</strong>,:    That’s better. But I still have problems. You seem to imply that I have to give Charon my password every time I want to use a service for which I don’t have a ticket. I login and want to access my files. I fire off a request to Charon for the proper ticket and this means that I’ve had to use my password. Then I want to read my mail. Another request to Charon, I have to enter my password again. Now suppose I want to send one of my mail messages to the print server. Another Charon request and, well you get the picture.<br><strong>Athena</strong>,:    Uh, yeah, I do.<br><strong>Euripides</strong>,:    And if that weren’t bad enough, consider this: it sounds like when you authenticate yourself to Charon, you send your secret password over the network in cleartext. Clever people like yours truly can monitor the network and steal copies of people’s passwords. If I’ve got your password, I can use any service in your name. <strong>Athena</strong>, sighs.<br><strong>Athena</strong>,:    These are serious problems. Guess I need to go back to the drawing board.</p><h2 id="Scene-III"><a href="#Scene-III" class="headerlink" title="Scene III"></a>Scene III</h2><p>The next morning, <strong>Athena</strong>, catches <strong>Euripides</strong>, at the coffee area. She taps him on the shoulder as he fills his cup.<br>The two head for the coffee machine.</p><p><strong>Athena</strong>,:    I’ve got a new version of Charon that solves our problems.<br><strong>Euripides</strong>,:    Really? That was quick.<br><strong>Athena</strong>,:    Well, you know, problems of this nature keep me up all night.<br><strong>Euripides</strong>,:    Must be your guilty conscience. Shall we repair to yon small conference room?<br><strong>Athena</strong>,:    Why not?<br>The two move to the small conference room.<br><strong>Athena</strong>,:    I’ll begin by stating the problems again, but I’ll invert them so that they become requirements of the system.<br><strong>Athena</strong>, clears her throat.<br><strong>Athena</strong>,:    The first requirement: Users only have to enter their passwords once, at the beginning of their workstation sessions. This requirement implies that you shouldn’t have to enter your password every time you need a new service ticket. The second requirement: passwords should not be sent over the network in clear text.<br><strong>Euripides</strong>,:    Okay.<br><strong>Athena</strong>,:<br>I’ll start with the first requirement: you should only have to use your password once. I’ve met this requirement by inventing a new network service. It’s called the “ticket-granting” service, a service that issues Charon tickets to users who have already proven their identity to Charon. You can use this ticket-granting service if you have a ticket for it, a ticket-granting ticket.</p><p>The ticket-granting service is really just a version of Charon in as much as it has access to the Charon database. It’s a part of Charon that lets you authenticate yourself with a ticket instead of a password.</p><p>Anyhow, the authentication system now works as follows: you login to a workstation and use a program called kinit to contact the Charon server. You prove your identity to Charon, and the kinit program gets you a ticket-granting ticket.</p><p>Now say you want to get your mail from the mail server. You don’t have a mail server ticket yet, so you use the “ticket-granting” ticket to get the mail server ticket for you. You don’t have to use your password to get the new ticket.</p><p><strong>Euripides</strong>,:    Do I have to get a new “ticket-granting” ticket every time I need to get to another network service?.<br><strong>Athena</strong>,:    No. Remember, we agreed last time that tickets can be reused. Once you have acquired a ticket-granting ticket, you don’t need to get another. You use the ticket-granting ticket to get the other tickets you need.<br><strong>Euripides</strong>,:    Okay, that makes sense. And since you can reuse tickets, once the ticket-granting service has given you a ticket for a particular service, you don’t need to get that particular ticket again.<br><strong>Athena</strong>,:    Yeah, isn’t that elegant?<br><strong>Euripides</strong>,:    Okay, I buy it so far . . . As long as you didn’t have to send your password in cleartext over the network when you got the ticket-granting ticket.<br><strong>Athena</strong>,:<br>Like I said, I’ve solved that problem as well. The thing is, when I say you have to contact Charon to get the ticket-granting ticket, I make it sound as though you have to send your password in cleartext over the network to the Charon Server. But it doesn’t have to be that way.</p><p>Here’s really what happens. When you use the kinit program to get the ticket-granting ticket, kinit doesn’t send your password to the Charon server, kinit sends only your username.</p><p><strong>Euripides</strong>,:    Fine.<br><strong>Athena</strong>,:<br>Charon uses the username to look up your password. Next Charon builds a packet of data that contains the ticket-granting ticket. Before it sends you the packet, Charon uses your password to encrypt the packet’s contents.</p><p>Your workstation receives the ticket packet. You enter your password. Kinit attempts to decrypt the ticket with the password you entered. If kinit succeeds, you have successfully authenticated yourself to Charon. You now possess a ticket-granting ticket, and that ticket can get you the other tickets you require.</p><p>How’s that for some fancy thinking?</p><p><strong>Euripides</strong>,:    I don’t know . . . I’m trying to think myself. You know, I think the parts of the system that you just described work pretty well. Your system requires me to authenticate myself only once. Thereafter Charon can issue me service tickets without my being aware of it. Seamless, seamless in that regard. But there’s something about the design of the service ticket that troubles me somehow. It has to do with the fact that tickets are reusable. Now I agree that they have to be reusable, but reusable tickets are, by their nature, very dangerous.<br><strong>Athena</strong>,:    What do you mean?<br><strong>Euripides</strong>,:<br>Look at it this way. Suppose you are using an insecure workstation. In the course of your login session you acquire a mail service ticket, a printing service ticket, and a file service ticket. Suppose you inadvertantly leave these tickets on the workstation when you logout.</p><p>Now suppose I login to the workstation and find those tickets. I’m feeling like causing trouble, so I make the workstation think that I am you. Since the tickets are made out in your name, I can use the mail client program to access your mail, I can use the file service client to access and remove your files, and I can use the printing command to run up huge bills on your account. All because these tickets have been accidentally left lying around.</p><p>And nothing can keep me from copying these tickets to a place of my own. I can continue to use them for all eternity.</p><p><strong>Athena</strong>,:<br>But that’s an easy fix. We just write a program that destroys a user’s tickets after each login session. You can’t use tickets that have been destroyed.</p><p><strong>Euripides</strong>,:<br>Well obviously your system must have a ticket-destroying program, but it’s foolish to make users rely on such a thing. You can’t count on users to remember to destroy their tickets every time they finish a workstation session. And even if you rely upon your users to destroy their tickets, consider the following scenario.</p><p>I’ve got a program that watches the network and copies service tickets as they zip accross the network. Suppose I feel like victimizing you. I wait for you to begin a workstation session, I turn on my program and copy a bunch of your tickets.</p><p>I wait for you to finish your session, and eventually you logout and leave. I fiddle with my workstation’s network software and change its address so that it matches the address of the workstation you were using when you acquired the tickets I copied. I make my workstation believe that I am you. I have your tickets, your username, and the correct network address. I can REPLAY these tickets and use services in your name.</p><p>It doesn’t matter that you destroyed your tickets before you ended your workstation session. The tickets I have stolen are valid for as long as I care to use them, because your current ticket design does not place a limit on the number of times you can reuse a ticket, or on how long a ticket remains valid.</p><p><strong>Athena</strong>,:    Oh I see what you’re saying! Tickets can’t be valid forever because they would then constitute a huge security risk. We have to restrict the length of time for which a ticket can be used, perhaps give each ticket some kind of expiration date.<br><strong>Euripides</strong>,:    Exactly. I think each ticket needs to have two additional pieces of information: a lifespan that indicates the length of time for which the ticket is valid, and a timestamp that indicates the date and time at which Charon issued the ticket. So a ticket would look something like this:<br><strong>Euripides</strong>, goes to the chalkboard and scrawls the following:</p><p>   TICKET   {username:address:servicename:lifespan:timestamp}<br><strong>Euripides</strong>,:    Now when a service decrypts tickets, it checks the ticket’s username and address against the name and address of the person sending the ticket, and it uses the timestamp and lifespan information to see if the ticket has expired.<br><strong>Athena</strong>,:    All right. What kind of lifetime should the typical service ticket have?<br><strong>Euripides</strong>,:    I don’t know. Probably the length of a typical workstation session. Say eight hours.<br><strong>Athena</strong>,:    So if I sit at my workstation for more than eight hours, all my tickets expire. That includes my ticket-granting ticket. So I have to reauthenticate myself to Charon after eight hours.<br><strong>Euripides</strong>,:    That’s not unreasonable is it?<br><strong>Athena</strong>,:    I guess not. So we’re settled – tickets expire after eight hours. Now I’ve got a question for you. Suppose I have copied YOUR tickets from the network–<br><strong>Euripides</strong>,:    (Eyes twinkling) Aw, Tina! You wouldn’t really do that would you?<br><strong>Athena</strong>,:<br>This is just for the sake of argument. I’ve copied your tickets. Now I wait for you to logout. Suppose you have a doctor’s appointment or a class to attend, so you end your workstation session after a couple of hours. You are a smart boots and have destroyed your copies of the tickets before logging out.</p><p>But I’ve stolen your tickets, and they are good for about six hours. That gives me ample time to pillage your files and print one thousand copies of whatever in your name.</p><p>See, the lifetime-timestamp business works fine in the event that a ticket thief chooses to replay the ticket after the ticket has expired. If the thief can replay the ticket before that . . .</p><p><strong>Euripides</strong>,:    Uh, well . . . Of course you are right.<br><strong>Athena</strong>,:    I think we have run into a major problem. (She sighs.)<br>Pause.<br><strong>Euripides</strong>,:    I guess that means you’ll be busy tonight. Want more coffee?<br><strong>Athena</strong>,:    Why not.</p><h2 id="Scene-IV"><a href="#Scene-IV" class="headerlink" title="Scene IV"></a>Scene IV</h2><p>The next morning in <strong>Euripides</strong>,’ office. <strong>Athena</strong>, knocks on the door.</p><p><strong>Euripides</strong>,:    You’ve got rings under your eyes this morning.<br><strong>Athena</strong>,:    Well, you know. Another one of those long nights.<br><strong>Euripides</strong>,:    Have you solved the replay problem?<br><strong>Athena</strong>,:    I think so.<br><strong>Euripides</strong>,:    Have a seat.<br>She does.<br><strong>Athena</strong>,:    As usual, I feel compelled to restate the problem. Tickets are reusable within a limited timespan, say eight hours. If someone steals your tickets and chooses to replay them before they expire, we can’t do anything to stop them.<br><strong>Euripides</strong>,:    That’s the problem.<br><strong>Athena</strong>,:    We could beat the problem if we designed the tickets so they couldn’t be reusable.<br><strong>Euripides</strong>,:    But then you would have to get a new ticket every time you wanted to use a network service.<br><strong>Athena</strong>,:<br>Right. That is a clumsy solution at best. (Pause.) Ah, how do I proceed with my argument? (She ponders for a moment.)</p><p>All right, I’m going to restate the problem again, this time in the form of a requirement. A network service must be able to prove that the person using a ticket is the same person to whom that ticket was issued.</p><p>Let me trace the authentication process again and see if I can tease out an appropriate way to illustrate my solution to this problem.</p><p>I want to use a certain network service. I access that service by starting a client program on my workstation. The client sends three things to the service machine– my name, my workstation’s network address, and the appropriate service ticket.</p><p>The ticket contains the name of the person it was issued to and the address of the workstation that person was using when he or she acquired the ticket. It also contains an expiration date in the form of a lifespan and a timestamp. All this information has been encrypted in the service’s Charon password.</p><p>Our current authentication scheme relies on the following tests:</p><p>Can the service decrypt the ticket?<br>Has the ticket expired?<br>Do the name and workstation address specified in the ticket match the name and address of the person who sent the ticket?<br>What do these tests prove? The first test proves that the ticket either did or did not come from Charon. If the ticket cannot be decrypted, it did not come from the real Charon. The real Charon would have encrypted the ticket with the service’s password. Charon and the service are the only two entities that know the service’s password. If the ticket decrypts successfully, the service knows that it came from the real Charon. This test prevents folks from building fake Charon tickets.</p><p>The second test checks the ticket’s lifespan and timestamp. If it has expired, the service rejects the ticket. This test stops people from using old tickets, tickets that perhaps were stolen.</p><p>The third test checks the ticket-user’s name and address against the name and address of the person specified in the ticket. If the test fails, the ticket-user has obtained (perhaps surreptitiously) another person’s ticket. The ticket is of course rejected.</p><p>If the names and addresses do match, what has the test proved? Nothing. Scallywags can steal tickets from the network, change their workstation addresses and usernames appropriately, and rifle other folks resources. As I pointed out yesterday, tickets can be replayed as long as they haven’t expired. They can be replayed because a service cannot determine that the person sending the ticket is actually the ticket’s legitimate owner.</p><p>The service cannot make this determination because it does not share a secret with the user. Look at it this way. If I’m on watch at Elsinore, you know, the castle in Hamlet, and you are supposed to relieve me, I’m not supposed to let you take my place unless you can provide the correct password. That’s the case where the two of us share a secret. And it’s probably a secret that someone else made up for everyone who stands on watch.</p><p>So I was thinking last night, why not have Charon make up a password for the legitimate ticket-owner to share with the service? Charon gives a copy of this session key to the service, and a copy to the user. When the service receives a ticket from a user, it can use the session key to test the user’s identity.</p><p><strong>Euripides</strong>,:    Wait a second. How is Charon going to give both parties the session key?<br><strong>Athena</strong>,:    The ticket-owner gets the session key as part of the reply from Charon. Like this:<br>She scrawls the following on a chalkboard:</p><p> CHARON REPLY  -  [sessionkey|ticket]<br>The service’s copy of the session key comes inside the ticket, and the service gets the key when it decrypts the ticket. So the ticket looks like this:</p><p> TICKET -  {sessionkey:username:address:servicename:lifespan:timestamp}<br>When you want to get to a service, the client program you start builds what I call an AUTHENTICATOR. The authenticator contains your name and your workstation’s address. The client encrypts this information with the session key, the copy of the session key you received when you requested the ticket.</p><p>  AUTHENTICATOR - {username:address} encrypted with session key<br>After building the authenticator, the client sends it and the ticket to the service. The service cannot decrypt the authenticator yet because it doesn’t have the session key. That key is in the ticket, so the service first decrypts the ticket.</p><p>After decrypting the ticket, the service ends up with the the following information:</p><p>The ticket’s lifespan and timestamp;<br>The ticket-owner’s name;<br>The ticket-owner’s network address;<br>The session key.<br>The service checks to see if the ticket has expired. If all is well in that regard, the service next uses the session key to decrypt the authenticator. If the decryption proceeds without a hitch, the service ends up with a username and a network address. The service tests this information against the name and address found in the ticket, AND the name and address of the person who sent the ticket and authenticator. If everything matches, the service has determined that the ticket-sender is indeed the ticket’s real owner.</p><p><strong>Athena</strong>, pauses, clears her throat, drinks some coffee.</p><p>I think the session key-authenticator business takes care of the replay problem.</p><p><strong>Euripides</strong>,:    Maybe. But I wonder . . . To break this version of the system, I must have the proper authenticator for the service.<br><strong>Athena</strong>,:    No. You must have the authenticator AND the ticket for the service. The authenticator is worthless without the ticket because the service cannot decrypt the authenticator without first having the appropriate session key, and the service cannnot get the appropriate session key without first decrypting the ticket.<br><strong>Euripides</strong>,:    Okay, I understand that, but didn’t you say that when a client program contacts the server, it sends the ticket and matching authenticator together?<br><strong>Athena</strong>,:    Yes, I guess I said that.<br><strong>Euripides</strong>,:    If that’s what actually happens, what prevents me from stealing the ticket and authenticator at the same time? I’m sure I could write a program to do the job. If I’ve got the ticket and its authenticator, I believe I can use the two as long as the ticket has not expired. I just have to change my workstation address and username appropriately. True?<br><strong>Athena</strong>,:    (Biting her lip) True. How dispiriting.<br><strong>Euripides</strong>,:    Wait, wait, wait! This isn’t such a big deal. Tickets are reusable as long as they haven’t expired, but that doesn’t mean that authenticators have to be reusable. Suppose we design the system so that authenticators can only be used once. Does that buy us anything?<br><strong>Athena</strong>,:<br>Well, it might. Let’s see, the client program builds the authenticator, then sends it with the ticket to the service. You copy both ticket and authenticator as they move from my workstation to the server. But the ticket and authenticator arrive at the server before you can send your copies. If the authenticator can only be used once, your copy of it is no good, and you lose when you attempt to replay your ticket and authenticator.</p><p>Well, that’s a relief. So all we have to do is invent a way to make the authenticator a one-time usable thing.</p><p><strong>Euripides</strong>,:<br>No problem. Let’s just put a lifespan and timestamp on them. Suppose each authenticator has a lifespan of a couple of minutes. When you want to use a service, your client program builds the authenticator, stamps it with the current time, then sends it and the ticket to the server.</p><p>The server receives the ticket and authenticator and goes about its business. When the server decrypts the authenticator, it checks the authenticator’s lifespan and timestamp. If the authenticator hasn’t expired, and everything else checks properly, the server considers you authenticated.</p><p>Suppose I copied the athenticator and ticket as they crossed the network. I have to change my workstation’s network address and my username, and I have to do this all in a couple of minutes. That’s a pretty tall order. In fact I don’t think it’s possible. Unless . . .</p><p>Well, here’s a potential problem. Suppose that instead of copying the ticket and authenticator as they travel from your workstation to the server, I copy original ticket packet that comes from Charon, the packet you receive when you ask Charon to give you a ticket.</p><p>This packet, as I recall, has two copies of the session key in it: one for you and one for the service. The one for the service is hidden in the ticket and I can’t get to it, but what about the other one, the one you use to build authenticators?</p><p>If I can get that copy of the session key, I can build my own authenticators, and if I can build my own authenticators, I can break the system.</p><p><strong>Athena</strong>,:<br>That’s something I thought about last night, but then I traced the process of acquiring tickets and found that it wasn’t possible to steal authenticators that way.</p><p>You sit down at a workstation and use the kinit program to get your ticket-granting ticket. Kinit asks for your username, and after you enter it, kinit forwards the name to Charon.</p><p>Charon uses your name to look up your password, then proceeds to build a ticket-granting ticket for you. As part of this process, Charon creates a session key that you will share with the ticket-granting service. Charon puts a copy of the session key in the ticket-granting ticket, and puts your copy in the the ticket packet that you are about to receive. But before it sends you this packet, Charon encrypts the whole thing with your password.</p><p>Charon sends the packet across the network. Someone can copy the packet as it goes by, but they can’t do anything with it because it has been encrypted with your password. Specifically, no one can steal the ticket-granting session key.</p><p>Kinit receives the ticket packet and prompts you for a password, which you enter. If you enter the correct password, kinit can decrypt the packet and give you your copy of the session key.</p><p>Now that you’ve taken care of the kinit business, you want to get your mail. You start the mail client program. This program looks for a mail service ticket and doesn’t find one (after all, you haven’t tried to get your mail yet). The client must use the ticket-granting ticket to ask the ticket-granting service for a mail service ticket.</p><p>The client builds an authenticator for the ticket-granting transaction and encrypts the authenticator with your copy of the ticket-granting session key. The client then sends Charon the authenticator, the ticket-granting ticket, your name, your workstation’s address, and the name of the mail service.</p><p>The ticket-granting service receives this stuff and runs through the authentication checks. If everything checks properly, the ticket-granting service ends up with a copy of the session key that it shares with you. Now the ticket-granting service builds you a mail service ticket, and during this process, creates a new session key for you to share with the mail service.</p><p>The ticket-granting service now prepares a ticket packet to send back to your workstation. The packet contains the ticket and your copy of the mail service session key. But before it sends the packet, the ticket-granting service encrypts the packet with its copy of the TICKET-GRANTING session key. That done, the packet is sent on its way.</p><p>So here comes the mail service ticket packet, loping across the network. Suppose some network ogre copies it as it goes by. The ogre is out of luck because the packet is encrypted with the ticket-granting session key; you and the ticket-granting service are the only entities that know this key. Since the ogre cannot decrypt the mail ticket packet, the ogre cannot discover the MAIL SESSION KEY. Without this session key, the ogre cannot use any of the mail service tickets you might subsequently send across the network.</p><p>So I think we’re safe. What do you think?</p><p><strong>Euripides</strong>,:    Perhaps.<br><strong>Athena</strong>,:    Perhaps! Is that all you can say!<br><strong>Euripides</strong>,:    (laughing) Don’t get upset. You should know my ways by now. I guess it is mean of me, and you up half the night.<br><strong>Athena</strong>,:    Pthhhhh!<br><strong>Euripides</strong>,:    All right, three-quarters of the night. Actually, the system is beginning to sound acceptible. This session key business solves a problem that I thought of last night: the problem of mutual authentication.<br>Pause.<br>Mind if I talk for a minute?<br><strong>Athena</strong>,:    (A trifle coldly) Be my guest.<br><strong>Euripides</strong>,:<br>You are so kind. (<strong>Euripides</strong>, clears his throat.) Last night, while visions of session keys and authenticators danced in your head, I was trying to find new problems with the system, and I found one that I thought was pretty serious. I’ll illustrate it by way of the following scenario.</p><p>Suppose you are sick of your current job and have determined that it is in your best interest to move on. You want to print your resume on the company’s wizz-bang laser printer so that headhunters and potential employers can take note of your classiness.</p><p>So you enter the printing command, and direct it to send the resume to the appropriate print server. The command gets the proper service ticket, if you don’t already have it, then sends the ticket in your name to the appropriate print server. At least that’s where you think it’s headed. You don’t in fact know that the request is headed for the right print server.</p><p>Suppose that some unscrupulous hacker–say it’s your boss–has screwed system around so that he redirects your request and its ticket to the print server in his office. His print service program doesn’t care about the ticket or its contents. It throws away the ticket and sends a message to your workstation indicating that the ticket passed muster, and that the server is ready and willing to print your job. The printing command sends the job to the fraudulant print server and the enemy ends up with your resume.</p><p>I’ll state the problem by way of contrast. Without session keys and authenticators, Charon can protect its servers from false users, but it cannot protect its users from false servers. The system needs a way for client programs to authenticate the server before sending sensitive information to the service. The system must allow for mutual authentication.</p><p>But the session key solves this problem as long as you design your client programs properly. Back to the print server scenario. I want a print client program that makes sure the service it’s sending jobs to is the legitimate service.</p><p>Here’s what such a program does. I enter the printing command and give it a filename, the name of my resume. Assume that I have a print service ticket and session key. The client program uses the session key to build an authenticator, then sends the authenticator and ticket to the “supposed” print server. The client DOES NOT send the resume yet; it waits for a response from the service.</p><p>The real service receives the ticket and authenticator, decrypts the ticket and extracts the session key, then uses the session key to decrypt the authenticator. This done, the service runs all the appropriate authentication tests.</p><p>Assume the tests confirm my identity. Now the server prepares a reply packet so that it can prove its identity to the client program. It uses its copy of the session key to encrypt the reply packet, then sends the packet to the waiting client.</p><p>The client receives the packet and attempts to decrypt it with my copy of the session key. If the packet decrypts properly and yields the correct server response message, my client program knows that the server that encrypted the packet is the real server. Now the client sends the resume job to the print service.</p><p>Suppose my boss screwed around the system so that his print server poses as the one I want. My client sends the authenticator and ticket to the “print service” and waits for a response. The fake print service cannot generate the correct response because it cannot decrypt the ticket and get the session key. My client will not send the job unless it receives the correct response. Eventually the client gives up waiting and exits. My print job does not get completed, but at least my resume did not end up on the desk of the enemy.</p><p>You know, I think we have a solid basis on which to implement the Charon Authentication System.</p><p><strong>Athena</strong>,:    Perhaps. Anyway, I don’t like the name “Charon.”<br><strong>Euripides</strong>,:    You don’t? Since when?<br><strong>Athena</strong>,:    I’ve never liked it, because the name doesn’t make sense. I was talking to my Uncle Hades about it the other day, and he suggested another name, the name of his three-headed watch dog.<br><strong>Euripides</strong>,:    Oh, you mean “Cerberus.”<br><strong>Athena</strong>,:    Bite your tongue Rip! “Cerberus” indeed . . .<br><strong>Euripides</strong>,:    Er, isn’t that the name?<br><strong>Athena</strong>,:    Yeah, if you happen to be a Roman! I’m a Greek goddess, he’s a Greek watch dog, and his name is “Kerberos,” “Kerberos” with a K.<br><strong>Euripides</strong>,:    Okay, okay, don’t throw thunderbolts. I’ll buy the name. Actually, it has a nice ring to it. Adios Charon and hello to Kerberos.</p>]]></content>
      
      
      <categories>
          
          <category> authentication </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MSGP</title>
      <link href="/2019/12/09/golang/msgp/"/>
      <url>/2019/12/09/golang/msgp/</url>
      
        <content type="html"><![CDATA[<p>“MessagePack is an efficient binary serialization format. It lets you exchange data among multiple languages like JSON. But it’s faster and smaller. Small integers are encoded into a single byte, and typical short strings require only one extra byte in addition to the strings themselves.”</p><p><img src="/images/msgp-speed.png" alt="Speed Test"></p><p>For more detail specification, you can view <a href="https://gist.github.com/frsyuki/543255" target="_blank" rel="noopener">MSGP update proposal V5</a>.</p><h2 id="Why-Smaller"><a href="#Why-Smaller" class="headerlink" title="Why Smaller"></a>Why Smaller</h2><p>cause JSON is a <strong>text based protocal</strong>, it’s easy to read by human while extra format characters are necessary. There’s a example.</p><p>If we define a struct <strong>User</strong> in golang,</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">type User struct &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">Name      string &#96;json:&quot;name&quot;&#96;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">Gender    string &#96;json:&quot;gender&quot;&#96;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">Age       int    &#96;json:&quot;age&quot;&#96;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">Bio       string &#96;json:&quot;bio&quot;&#96;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure><p>the JSON marshal result will be</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    &quot;name&quot;:&quot;DL&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    &quot;gender&quot;:&quot;male&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    &quot;age&quot;:1024,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    &quot;bio&quot;:&quot;let&#39;s dance!&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure><p>there’re <strong>23</strong> bytes for brace, comma and colon. While, MSGP uses a Type System to reduce these extra overhead, for example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">fixmap stores a map whose length is upto 15 elements</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">+--------+~~~~~~~~~~~~~~~~~+</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">|1000XXXX|   N*2 objects   |</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">+--------+~~~~~~~~~~~~~~~~~+</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">where</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">* XXXX is a 4-bit unsigned integer which represents N</span></pre></td></tr></table></figure><p>What’s more, there’s a compression algorithm of MSGP, which means less bytes will be used. For example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">false:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">+--------+</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">|  0xc2  |</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">+--------+</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">true:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">+--------+</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">|  0xc3  |</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">+--------+</span></pre></td></tr></table></figure><h2 id="Why-Faster"><a href="#Why-Faster" class="headerlink" title="Why Faster"></a>Why Faster</h2><p>We usually use cJSON library to marshal/unmarshal JSON. cJSON uses <strong>linked list</strong> to store a <strong>tree</strong>. We need to scan each char to locate it’s node one by one. With useing MSGP, we do not need to match char cause there’s a <strong>type</strong> and <strong>length</strong> of each kind of MSGP data type.</p>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>How to Send Non-Spam E-mail</title>
      <link href="/2019/11/29/email/how-to-send-non-spam-email/"/>
      <url>/2019/11/29/email/how-to-send-non-spam-email/</url>
      
        <content type="html"><![CDATA[<h2 id="Why-is-E-mail-still-alive"><a href="#Why-is-E-mail-still-alive" class="headerlink" title="Why is E-mail still alive"></a>Why is E-mail still alive</h2><p>E-mail has already existed for nearly 50 years <a href="https://blog.cloudflare.com/the-history-of-email/" target="_blank" rel="noopener">1971</a>. Though IM and OA have developed a lot recently years, it seems that we still can not eliminate E-mail from our lives. The reasons may be:</p><ul><li>E-mail is widespread around the world. No matter Facebook, Google, Wechat or any others couldn’t claim that they have already connected everyone. But excatly everyone has E-mail address.</li><li>E-mail has already been the foundation of the Internet account system. Though <a href="https://rony13.github.io/2019/11/28/oauth2/">OAuth</a> has already been the most convenient way to sign up/in, you’ll find it out that E-mail is usually the origianl way of OAuth trace.</li><li>It can be used not only for communication but also as a storage tool.</li><li>The agreement reached by mail have legal effectiveness cause E-mail is irreversible and read-only. Recall your offers.</li></ul>]]></content>
      
      
      <categories>
          
          <category> email </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>OAuth2.0</title>
      <link href="/2019/11/28/sso/oauth2/"/>
      <url>/2019/11/28/sso/oauth2/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> sso </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Simple Mail Transfer Protocol (SMTP)</title>
      <link href="/2019/11/28/email/smtp/"/>
      <url>/2019/11/28/email/smtp/</url>
      
        <content type="html"><![CDATA[<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>SMTP is a <strong>connection-oriented</strong>, <strong>text-based protocol</strong> in which a mail sender communicates with a mail receiver by issuing command strings and supplying necessary data over a reliable ordered data stream channel, typically a TCP connection.</p><p>SMTP defines <strong>message transport</strong>, not the message content. Thus, it defines the mail envelope and its parameters, such as the envelope sender, but not the header (except trace information) nor the body of the message itself.</p><p>SMTP is a <strong>Application Layer Protocal</strong>. E-mail is submitted by a <strong>MUA</strong>(mail user agent) to a <strong>MSA</strong>(mail submission agent) using <strong>SMTP</strong> on <strong>TCP</strong>. The MSA delivers the mail to its <strong>MTA</strong>(MTA). Often, these two agents are instances of the same software launched with different options on the same machine. Local processing can be done either on a single machine, or split among multiple machines; mail agent processes on one machine can share files, but if processing is on multiple machines, they transfer messages between each other using SMTP, where each machine is configured to use the next machine as a smart host. Each process is an <strong>MTA</strong>(an SMTP server) in its own right.</p><p>The boundary MTA uses the <strong>DNS</strong>(Domain name system) to look up the <strong>MX Record</strong>(mail exchanger record) for the recipient’s domain (the part of the email address on the right of @). The MX record contains the name of the target host. Based on the target host and other factors, the MTA selects an exchange server: see the article MX record. The MTA connects to the exchange server as an SMTP client.</p><p>Message transfer can occur in a single connection between two MTAs, or in a series of hops through intermediary systems. A receiving SMTP server may be the ultimate destination, an intermediate “relay” (that is, it stores and forwards the message) or a “gateway” (that is, it may forward the message using some protocol other than SMTP). Each hop is a formal handoff of responsibility for the message, whereby the receiving server must either deliver the message or properly report the failure to do so.</p><p>Once the final hop accepts the incoming message, it hands it to a <strong>MDA</strong>(mail delivery agent) for local delivery. An MDA saves messages in the relevant mailbox format. As with sending, this reception can be done using one or multiple computers, but in the diagram above the MDA is depicted as one box near the mail exchanger box. An MDA may deliver messages directly to storage, or forward them over a network using SMTP or other protocol such as <strong>LMTP</strong>(Local Mail Transfer Protocol), a derivative of SMTP designed for this purpose.</p><p>Once delivered to the local mail server, the mail is stored for batch retrieval by authenticated mail clients (MUAs). Mail is retrieved by end-user applications, called email clients, using <strong>IMAP</strong>(Internet Message Access Protocol), a protocol that both facilitates access to mail and manages stored mail, or the <strong>POP3</strong>(Post Office Protocol Version 3) which typically uses the traditional mbox mail file format or a proprietary system such as Microsoft Exchange/Outlook or Lotus Notes/Domino. Webmail clients may use either method, but the retrieval protocol is often not a formal standard.</p><p><img src="/images/smtp-overview.png" alt="overview"></p><h2 id="MX-Record"><a href="#MX-Record" class="headerlink" title="MX Record"></a>MX Record</h2><p>A MX record(mail exchanger record) specifies the mail server responsible for accepting email messages on behalf of a domain name. It is a resource record in the DNS(Domain Name System). It is possible to configure several MX records, typically pointing to an array of mail servers for load balancing and redundancy.</p><p>You can search for the MX records for a specific domain with <strong>nslookup</strong> on mac:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"># nslookup</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&gt; set q&#x3D;mx</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&gt; gmail.com</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">Server:10.86.96.1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">Address:10.86.96.1#53</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">Non-authoritative answer:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">gmail.commail exchanger &#x3D; 40 alt4.gmail-smtp-in.l.google.com.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">gmail.commail exchanger &#x3D; 5 gmail-smtp-in.l.google.com.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">gmail.commail exchanger &#x3D; 10 alt1.gmail-smtp-in.l.google.com.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">gmail.commail exchanger &#x3D; 20 alt2.gmail-smtp-in.l.google.com.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">gmail.commail exchanger &#x3D; 30 alt3.gmail-smtp-in.l.google.com.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">Authoritative answers can be found from:</span></pre></td></tr></table></figure><h2 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h2><p>Authencication, Authorization and Audit is a big topic, we’ll discuss later.</p><h2 id="Port"><a href="#Port" class="headerlink" title="Port"></a>Port</h2><p>There’re three ports for SMTP</p><ol><li><p>Port 25<br>the oldest port. It’s suggested to be used between MTAs in order to against spam E-mail.</p></li><li><p>Port 587<br>You need authentication when use port 587, that’s why it’s recomanded to use between MUA and MSA.</p></li><li><p>Port 465<br>Deprecated.</p></li></ol><p><img src="/images/smtp-port.png" alt="port"></p><h2 id="Transport-Example"><a href="#Transport-Example" class="headerlink" title="Transport Example"></a>Transport Example</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">~ telnet smtp.163.com 25</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">Trying 220.181.12.12...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">Connected to smtp.163.com.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">Escape character is &#39;^]&#39;.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">220 163.com Anti-spam GT for Coremail System (163com[20141201])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">EHLO SMTP</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">250-mail</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">250-PIPELINING</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">250-AUTH LOGIN PLAIN</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">250-AUTH&#x3D;LOGIN PLAIN</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">250-coremail 1Uxr2xKj7kG0xkI17xGrU7I0s8FY2U3Uj8Cz28x1UUUUU7Ic2I0Y2UFJbpo8UCa0xDrUUUUj</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">250-STARTTLS</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">250 8BITMIME</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">AUTH LOGIN</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">334 dXNlcm5hbWU6</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">dG9ueUAxNjMuY29t</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">334 UGFzc3dvcmQ6</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">dGVzdA&#x3D;&#x3D;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">535 Error: authentication failed</span></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> email </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
